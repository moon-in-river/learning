## nextjs 开发指南

参考 https://github.com/moon-in-river/NuggetsBooklet/tree/master/Next.js%20%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97

时间短，学习的量大。及时反馈、及时满足的方式比延迟满足好的多。

##### 怎么学这个小册

- 基础篇前 20 篇，了解如何使用脚手架、如何定义路由、如何获取数据、如何定义样式等写 Next.js 项目最基本的知识
- 基础篇后 16 篇作为开发手册使用，可以 10 分钟看完一篇
- 实战篇，至少写出第一个实战项目 React Notes
- 源码篇，了解实现原理

# 路由模式

## App 路由

同一文件夹下如果有 layout.js 和 page.js，page 会作为 children 参数传入 layout。换句话说，layout 会包裹同层级的 page。

- 如果你要更改这些标签，_不推荐直接修改_，参考《Metadata 篇》。
- 可以使用*路由组*创建多个根布局。

### 模板

用法跟布局一模一样。它们最大的区别就是状态的保持。layout 会包裹 template，template 又会包裹 page。适用场景：

- 依赖于 useEffect 和 useState 的功能，比如记录页面访问数（维持状态就不会在路由切换时记录访问数了）、用户反馈表单（每次重新填写）等
- 更改框架的默认行为，举个例子，布局内的 Suspense 只会在布局加载的时候展示一次 fallback UI，当切换页面的时候不会展示。但是使用模板，fallback 会在每次路由切换的时候展示https://juejin.cn/post/7343569488744300553

### 定义加载页面

使用 Suspense 组件或者使用 use api 都可以实现页面的加载效果

### 定义错误页面

error.js 展示错误发生时的展示页面，使用 React 的 Error Boundary 组件捕获错误，并展示错误页面。

- 有时错误是暂时的，只需要重试就可以解决问题，在 error.js 导出的组件中，传入 reset 函数，帮助尝试从错误中恢复。该函数会触发重新渲染错误边界里的内容。如果成功，会替换展示重新渲染的内容。
- 错误边界不能捕获同级的 layout.js 或者 template.js 中的错误。如果你想捕获特定布局或者模板中的错误，那就需要在父级的 error.js 里进行捕获。如果已经到了顶层，就比如根布局中的错误如何捕获呢？为了解决这个问题，Next.js 提供了 global-error.js 文件，使用它时，需要将其放在 app 目录下。

### 定义未找到页面

使用 not-found.js 文件，展示未找到页面。

只能由两种情况触发：

- 当组件抛出了 notFound 函数的时候
- 当路由地址不匹配的时候
